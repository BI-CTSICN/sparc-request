!!!
%html{ :xmlns => "http://www.w3.org/1999/xhtml", :"xml:lang" => "en", :lang => "en" }

  %head
    %meta{ :"http-equiv" => "content-type", :content => "text/html;charset=UTF-8" }
    %title= t(:notifier)[:sr]

  %body
    - welcome_text = @service_request.status == "obtain_research_pricing" ? "A request has been made to obtain research pricing" : "Services have been requested or changed"
    -if @role == 'pi'
      %p
        Dear #{@identity.full_name},
      %p
        #{welcome_text} in SPARC (sparc.musc.edu) for your #{@protocol.type.downcase}
        listed below. In addition, below is a list of users who have been granted access to this
        #{@protocol.type.downcase} on your behalf.
    -else
      %p
        #{welcome_text} in SPARC (sparc.musc.edu) for a #{@protocol.type.downcase}
        to which you have been granted access.

    %table{:style => 'border: 1px solid black; border-collapse: collapse; width: 100%;', :cellpadding => 3}
      %thead
        %tr{:style => 'border: 1px solid black;'}
          %td{:colspan => 2}
            %strong= t(:notifier)[:p_info]
      %tbody
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'}= t(:notifier)[:p_id]
          %td{:style => 'border: 1px solid black;'}= @protocol.id
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'}= t(:notifier)[:title1]
          %td{:style => 'border: 1px solid black;'}= @protocol.short_title
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'}= t(:notifier)[:title2]
          %td{:style => 'border: 1px solid black;'}= @protocol.title
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'}= t(:notifier)[:s_name]
          %td{:style => 'border: 1px solid black;'}= @protocol.sponsor_name
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'}= t(:notifier)[:source]
          %td{:style => 'border: 1px solid black;'}= (@protocol.funding_source or @protocol.potential_funding_source or "").capitalize

    %br
    %br

    %table{:style => 'border: 1px solid black; border-collapse: collapse; width: 100%;', :cellpadding => 3}
      %thead
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; text-align: left;'}= t(:notifier)[:name]
          %th{:style => 'border: 1px solid black;'}= t(:notifier)[:role]
          %th{:style => 'border: 1px solid black;'}= t(:notifier)[:proxy]
      %tbody
        - @protocol.project_roles.each do |pr|
          %tr{:style => 'border: 1px solid black;'}
            %td{:style => 'border: 1px solid black;'}= pr.identity.full_name
            %td{:style => 'border: 1px solid black; text-align: center;'}= pr.role.upcase
            %td{:style => 'border: 1px solid black; text-align: center;'}= {"approve"=>"Authorize/Change Study Charges", "request"=>"Request/Approve Services", "view"=>"View Rights", "none"=>"Member Only"}[pr.project_rights]

    %p= t(:issue_contact)

    %p= t(:notifier)[:body6]
    - if @approval_link
      %p
        = t(:notifier)[:body7]
        %a{:style => "color: red; font-weight: bold;", :href => @approval_link}= t(:notifier)[:link]
        ="."
    %p
      %a{:style => "color: blue; font-weight: bold;", :href => @portal_link}=@portal_text
    
    - @service_request.service_list.map{|k, v| v[:acks]}.flatten.uniq.each do |ack|
      %p{:style => 'font-size: small;'}=ack

