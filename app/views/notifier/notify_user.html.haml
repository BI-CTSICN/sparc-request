!!!
%html{ :xmlns => "http://www.w3.org/1999/xhtml", :"xml:lang" => "en", :lang => "en" }

  %head
    %meta{ :"http-equiv" => "content-type", :content => "text/html;charset=UTF-8" }
    %title Service Request

  %body
    -if role == 'pi'
      %p
        Dear #{name},
      %p
        Services have been requested or changed in SPARC (sparc.musc.edu) for your #{project_type}
        listed below. In addition, below is a list of users who have been granted access to this
        #{project_type} on your behalf.
    -else
      %p
        Services have been requested or changed in SPARC (sparc.musc.edu) for a #{project_type}
        to which you have been granted access.

    %table{:style => 'border: 1px solid black; border-collapse: collapse; width: 100%;', :cellpadding => 3}
      %thead
        %tr{:style => 'border: 1px solid black;'}
          %td{:colspan => 2}
            %strong Project Information
      %tbody
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'} Project ID:
          %td{:style => 'border: 1px solid black;'}= project['friendly_id']
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'} Short Title:
          %td{:style => 'border: 1px solid black;'}= project['short_title']
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'} Project Title:
          %td{:style => 'border: 1px solid black;'}= project['title']
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'} Sponsor Name:
          %td{:style => 'border: 1px solid black;'}= project['sponsor_name']
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; width:200px; text-align:left;'} Funding Source:
          %td{:style => 'border: 1px solid black;'}= (project['funding_source'] or project['potential_funding_source'] or "").capitalize

    %br
    %br

    %table{:style => 'border: 1px solid black; border-collapse: collapse; width: 100%;', :cellpadding => 3}
      %thead
        %tr{:style => 'border: 1px solid black;'}
          %th{:style => 'border: 1px solid black; text-align: left;'} Name:
          %th{:style => 'border: 1px solid black;'} Role:
          %th{:style => 'border: 1px solid black;'} Proxy Rights:
      %tbody
        - users.each do |user|
          - role = roles.detect{|r| r['user_id'] == user['id']}
          %tr{:style => 'border: 1px solid black;'}
            %td{:style => 'border: 1px solid black;'}= "#{user['first_name']} #{user['last_name']}"
            %td{:style => 'border: 1px solid black; text-align: center;'}= role['role'].upcase
            %td{:style => 'border: 1px solid black; text-align: center;'}= {"approve"=>"Authorize/Change Study Charges", "request"=>"Request/Approve Services", "view"=>"View Rights", "none"=>"Member Only"}[role['project_rights']]
        
    %p A list of requested services is attached.
    - if approval_url
      %p
        To approve the charges associated with the selected services please click
        %a{:style => "color: red; font-weight: bold;", :href => approval_url} HERE
        ="."
    %p
      %a{:style => "color: blue; font-weight: bold;", :href => user_portal_link}=user_portal_text
    %p
      Please contact the SUCCESS Center at (843) 792-8300 for assistance with this process
      or with any questions you may have.
    - acks.each do |ack|
      %p{:style => 'font-size: small;'}=ack
