%tbody
  - if @service_request.has_per_patient_per_visit_services?
    %tr.section_header
      %th{:colspan => 12} Per Patient/Visit Services
    - @service_request.service_list(false).each do |key, value| # get only per patient/per visit services and group them
      %tr.sub_section_header
        %th{:colspan => 12}= value[:name]
        - value[:line_items].each do |line_item|
          %tr.line_item{:class => cycle('odd', '', :name => 'pppvs')}
            %td.service_name= line_item.service.name
            %td.service_rate $25.00
            %td.your_cost $20.00
            %td.unit_type= line_item.service.displayed_pricing_map.unit_type
            %td.subject_count= select_tag :count, options_for_select((0..@service_request.subject_count))
            %td &nbsp;
            - visits = line_item.visits.paginate(:page => params[:page], :per_page => 5)
            - visits.each do |v|
              %td.visit= line_item_visit_input line_item, v, 'template'
            %td.total $1000.00
    
    %th{:colspan => 12}
      %hr
    
    %tr.totals_section.begin_totals
      %td{:colspan => 5} Maximum Total Direct Costs Per Patient
      %td &nbsp;
      - 5.times do
        %td $0.00
      %td $2000.00
    
    %tr.totals_section
      %td{:colspan => 5} Maximum Total Indirect Costs Per Patient
      %td &nbsp;
      - 5.times do
        %td $0.00
      %td $2000.00

    %tr.totals_section
      %td{:colspan => 5} Maximum Total Per Patient
      %td &nbsp;
      - 5.times do
        %td $0.00
      %td $2000.00
    
    %tr.totals_section
      %td{:colspan => 5} Total Direct Costs (Per Patient/Visit Services) Per Study
      %td{:colspan => 6}
      %td $2000.00
    
    %tr.totals_section
      %td{:colspan => 5} Total Indirect Costs (Per Patient/Visit Services) Per Study
      %td{:colspan => 6}
      %td $2000.00
    
    %tr.totals_section
      %td{:colspan => 5} Total Costs (Per Patient/Visit Services) Per Study
      %td{:colspan => 6}
      %td $2000.00

    %th.totals_section{:colspan => 12} &nbsp;

  - if @service_request.has_one_time_fee_services?
    %tr.section_header
      %th{:colspan => 12} Other Services
    - @service_request.service_list(true).each do |key, value| # get only one time fee services and group them
      %tr.sub_section_header
        %th{:colspan => 12}= value[:name]
        - value[:line_items].each do |line_item|
          %tr.line_item{:class => cycle('odd', '', :name => 'otfs')}
            %td.service_name= line_item.service.name
            %td.service_rate $25.00
            %td.your_cost $20.00
            %td{:colspan => 8}
            %td $2000.00

    %th{:colspan => 12}
      %hr
    
    %tr.totals_section.begin_totals
      %td{:colspan => 5} Total Direct Costs (other) Per Study
      %td{:colspan => 6}
      %td $2000.00

    %tr.totals_section
      %td{:colspan => 5} Total Indirect Costs (other) Per Study
      %td{:colspan => 6}
      %td $2000.00

    %tr.totals_section
      %td{:colspan => 5} Total Costs (other) Per Study
      %td{:colspan => 6}
      %td $2000.00

    %th.totals_section{:colspan => 12} &nbsp;

  %tr.section_header
    %th{:colspan => 12} Total Study Costs

    %tr.totals_section
      %td{:colspan => 5} Grand Total: Direct Costs
      %td{:colspan => 6}
      %td $2000.00

    %tr.totals_section
      %td{:colspan => 5} Grand Total: Indirect Costs
      %td{:colspan => 6}
      %td $2000.00

    %tr.totals_section
      %td{:colspan => 5} Grand Total:
      %td{:colspan => 6}
      %td $2000.00
