
 / %tr.totals_section{:class => cycle('odd', '', :name => 'pppvs')}
        /   %td{:colspan => 5}= t("calendar_page.labels.total_direct")
        /   %td{:colspan => 6}
        /   %td{:class => "pp_total_direct_cost"}
        /   / TODO: Fix this for arms= display_total_direct_cost_per_study_pppvs @service_request, @line_items
        
        / - if USE_INDIRECT_COST
        /   %tr.totals_section{:class => cycle('odd', '', :name => 'pppvs')}
        /     %td{:colspan => 5}= t("calendar_page.labels.total_indirect")
        /     %td{:colspan => 6}
        /     %td{:class => "pp_total_indirect_cost"}
        /     / TODO: Fix this for arms= display_total_indirect_cost_per_study_pppvs @service_request, @line_items
        
        / %tr.totals_section.total-visit-based-services{:class => cycle('odd', '', :name => 'pppvs')}
        /   %td{:colspan => 5}= t("calendar_page.labels.total_costs")
        /   %td{:colspan => 6}
        /   %td{:class => "pp_total_cost"}
        /   / TODO: Fix this for arms= display_total_cost_per_study_pppvs @service_request, @line_items

        / %th.totals_section{:colspan => 12} &nbsp;

    / - if (@sub_service_request.nil? ? @service_request.has_one_time_fee_services? : @sub_service_request.has_one_time_fee_services?) and !@portal
    /   %tr.section_header
    /     %th{:colspan => 12}= t("calendar_page.headers.other_services")
    /   - @service_request.service_list(true).each do |key, value| # get only one time fee services and group them
    /     - next unless @sub_service_request.nil? or @sub_service_request.organization.name == value[:process_ssr_organization_name]
    /     %tr.sub_section_header
    /       %th{:colspan => 12}= value[:name]
    /       - value[:line_items].each do |line_item|
    /         %tr.line_item{:class => cycle('odd', '', :name => 'otfs')}
    /           %td.service_name= line_item.service.name
    /           %td{:class => "service_rate_#{line_item.id}"}= display_service_rate line_item
    /           %td.your_cost= display_your_cost line_item
    /           %td{:colspan => 8}
    /           %td{:class => "total_#{line_item.id}"}= display_one_time_fee_direct_cost line_item
      
    /   %tr.totals_section.begin_totals{:class => cycle('odd', '', :name => 'otfs')}
    /     %td{:colspan => 5}= t("calendar_page.labels.total_direct_other")
    /     %td{:colspan => 6}
    /     %td.otf_total_direct_cost= display_total_direct_cost_per_study_otfs @service_request, @line_items

    /   - if USE_INDIRECT_COST
    /     %tr.totals_section{:class => cycle('odd', '', :name => 'otfs')}
    /       %td{:colspan => 5}= t("calendar_page.labels.total_indirect_other")
    /       %td{:colspan => 6}
    /       %td.otf_total_indirect_cost= display_total_indirect_cost_per_study_otfs @service_request, @line_items

    /   %tr.totals_section{:class => cycle('odd', '', :name => 'otfs')}
    /     %td{:colspan => 5}= t("calendar_page.labels.total_costs_other")
    /     %td{:colspan => 6}
    /     %td.otf_total_cost= display_total_cost_per_study_otfs @service_request, @line_items

    /   %th.totals_section{:colspan => 12} &nbsp;

    / - unless @portal
    /   %tr.section_header
    /     %th{:colspan => 12}= t("calendar_page.headers.total_study")

    /     %tr.totals_section{:class => cycle('odd', '', :name => 'totals')}
    /       %td{:colspan => 5}= t("calendar_page.labels.grand_total_direct")
    /       %td{:colspan => 6}
    /       %td{:class => 'grand_total_direct'}= display_grand_total_direct_costs @service_request, @line_items

    /     - if USE_INDIRECT_COST
    /       %tr.totals_section{:class => cycle('odd', '', :name => 'totals')}
    /         %td{:colspan => 5}= t("calendar_page.labels.grand_total_indirect")
    /         %td{:colspan => 6}
    /         %td{:class => 'grand_total_indirect'}= display_grand_total_indirect_costs @service_request, @line_items

    /     %tr.totals_section{:class => cycle('odd', '', :name => 'totals')}
    /       %td{:colspan => 5}= t("calendar_page.labels.grand_total")
    /       %td{:colspan => 6}
    /       %td{:class => 'grand_total'}= display_grand_total @service_request, @line_items
