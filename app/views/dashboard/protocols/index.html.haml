-# Copyright Â© 2011 MUSC Foundation for Research Development
-# All rights reserved.

-# Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:

-# 1. Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.

-# 2. Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following
-# disclaimer in the documentation and/or other materials provided with the distribution.

-# 3. Neither the name of the copyright holder nor the names of its contributors may be used to endorse or promote products
-# derived from this software without specific prior written permission.

-# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING,
-# BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
-# SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
-# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
-# INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR
-# TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
:javascript
  $(document).ready( function() {
    Sparc.protocol.ready();
  })

  protocols_table_query_params = function(p) {
    if($('#toggle-archived').data('showing-archived') == false) {
      p['include_archived'] = 'false'
    } else {
      p['include_archived'] = 'true'
    }
    return p;
  }

.bootstrap-table-dropdown-overflow
  #protocols-toolbar
    .btn-group
      %button.btn.btn-success.dropdown-toggle#create-new-study-button{ type: 'button', 'aria-expanded' => 'false', data: { toggle: 'dropdown' }}
        %span
          .glyphicon.glyphicon-plus
          New Protocol
      %ul.dropdown-menu{ role: 'menu' }
        %li= link_to "New Study", new_dashboard_protocol_path(protocol_type: 'study')
        %li= link_to "New Project", new_dashboard_protocol_path(protocol_type: 'project')
    %button.btn.btn-default#toggle-archived{ type: 'button', data: { showing_archived: 'true' } } Show Only Active
  %table.protocols_table{ id: 'protocols_table', data: { toggle: 'table', search: 'true', show_columns: 'true', show_refresh:  'true', show_toggle: 'true', url: dashboard_protocols_path(format: :json), striped: 'true', toolbar: '#protocols-toolbar', show_export: 'true', export_types: ['excel'], row_style: 'protocols_row_style', side_pagination:  'server', pagination: 'true', page_size: '15', sort_name: 'id', sort_order: 'desc', query_params: 'protocols_table_query_params' } }
    %thead.primary-header
      %tr
        %th{ data: { class: 'id', align: 'left', sortable: 'true', field: 'id' } }
          ID
        %th{ data: { class: 'title', align: 'left', sortable: 'true', field: 'title' } }
          Short Title
        %th{ data: { class: 'pis', align: 'left', sortable: 'true', field: 'pis' } }
          PI(s)
        %th{ data: { class: 'requests', align: 'left', field: 'requests' } }
          Requests
        %th{ data: { class: 'archive_this', align: 'center', sortable: 'false', field: 'archive' } }
          Archive
