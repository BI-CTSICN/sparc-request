= form_for @core, :url => catalog_manager_core_path, :remote => true, :id => 'entity_form' do |f|
  = hidden_field_tag 'org_unit[id]', @core.id # added for autocomplete to use
  = hidden_field_tag 'core[id]', @core.id
  .errorExplanation#errorExplanation{:style => 'display:none;'}

  #entity_description
    %fieldset
      %legend= t(:organization_form)[:actions]
      = f.submit t(:organization_form)[:submit_button], :id => 'save_button', :class => 'save_button btn provider_program_core_save'
      %img.spinner{:src => '/assets/catalog_manager/spinner_small.gif'}

    %br

    %fieldset
      %legend= t(:organization_form)[:gen_info]
      %table
        %tr
          %th= f.label :name, t(:organization_form)[:name]
          %td= f.text_field :name
        %tr
          %th= f.label :abbreviation, t(:organization_form)[:abbreviation]
          %td= f.text_field :abbreviation
        %tr
          %th= f.label :description, t(:organization_form)[:description]
          %td= f.text_area :description, :rows => 8
        %tr
          %th= f.label :ack_language, t(:organization_form)[:ack_language]
          %td= f.text_area :ack_language, :rows => 8
        %tr
          %th= f.label :order, t(:organization_form)[:order]
          %td= f.text_field :order
        %tr
          %th= f.label :split_notify, t(:organization_form)[:split_notify]
          %td= f.check_box :process_ssrs
        %tr
          %th= f.label :disabled, t(:organization_form)[:disabled]
          %td= f.check_box :is_available, {:checked => (@core.is_available.nil? ? false : !@core.is_available) }, false, true
        %tr
          %th= t(:organization_form)[:tag_list]
          %td
            - Tag.all.each do |tag|
              %span
                %span= f.label tag.name.gsub("ctrc", "Nexus")
                %span= f.check_box :tag_list, { :multiple => true }, tag.name, nil

    %br

    = render :partial => 'catalog_manager/shared/available_statuses', :locals => {:f => f}
    
    %fieldset
      %legend= t(:organization_form)[:submission_emails]
      #se_info= render :partial => 'catalog_manager/shared/submission_emails', :locals => {:entity => @core}
      
    %br

    %fieldset
      %legend= t(:organization_form)[:super_users]
      #su_info= render :partial => 'catalog_manager/shared/super_users', :locals => {:entity => @core}
    
    %br

    %fieldset
      %legend= t(:organization_form)[:service_providers]
      #sp_info= render :partial => 'catalog_manager/shared/service_providers', :locals => {:entity => @core}
    
    %br
    
    %fieldset
      %legend= t(:organization_form)[:cm_rights]
      #cm_info= render :partial => 'catalog_manager/shared/catalog_managers', :locals => {:entity => @core}

    %br

    %fieldset
      %legend= t(:organization_form)[:clinical_work_fulfillment]
      %table
        %tr.cwf
          %th= t(:organization_form)[:show_in_cwf]
          %td= f.check_box :show_in_cwf
        %tr.cwf.position_field{:style => @core.show_in_cwf ? "" : "display:none;"}
          %th= t(:organization_form)[:position_in_cwf]
          %td= f.text_field :position_in_cwf
        %tr
          %th= t(:organization_form)[:clinical_providers]
      #cp_info= render :partial => 'catalog_manager/shared/clinical_providers', :locals => {:entity => @core}

    %br
    
    %fieldset
      %legend= t(:organization_form)[:auto_price_adj]
      = render :partial => 'catalog_manager/shared/increase_decrease_rates', :locals => {:entity => @core, :can_edit_historical_data => @user.can_edit_historical_data_for?(@core)}
    
    %br
    
    %fieldset
      %legend= t(:organization_form)[:subsidy_info]
      %table
        = f.fields_for :subsidy_map do |f_subsidy_map|
          %tr
            %th= f_subsidy_map.label :subsidy_max_percent, t(:organization_form)[:subsidy_max_percent]
            %td= f_subsidy_map.text_field :max_percentage
          %tr
            %th= f_subsidy_map.label :subsidy_max_dollar, t(:organization_form)[:subsidy_max_dollar]
            %td= f_subsidy_map.text_field :max_dollar_cap
          = render 'catalog_manager/shared/excluded_funding_sources', :entity => @core

    %br
      
    %fieldset
      %legend= t(:organization_form)[:associated_surveys]
      #associated_survey_info= render :partial => 'catalog_manager/shared/associated_surveys', :locals => {:entity => @core}

    %br


    %fieldset
      %legend= t(:organization_form)[:actions]
      = f.submit t(:organization_form)[:submit_button], :id => 'save_button', :class => 'save_button btn provider_program_core_save'
      %img.spinner{:src => '/assets/catalog_manager/spinner_small.gif'}
      .ui-corner-all.blank_field_errors= t(:organization_form)[:errors]

:javascript
  $(document).ready( function() {
    Sparc.config.ready();
    Sparc.services.ready();
  })  
